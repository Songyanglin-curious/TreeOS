# TreeOS 核心宪章与开发指南

## 一、本质定义

TreeOS 是一个将模糊输入转化为可确认、可演进的结构化资产的人机协作引擎。其核心价值不在于树形结构本身，而在于实现思考的收敛性、变化的可控性以及局部迭代的常态化。

系统内人与 AI 的角色分工明确：

- AI 负责发散：补全隐含信息，提供候选方案
- 人类负责收敛：确认节点有效性，决定结构走向

## 二、三层架构原则

为避免复杂度失控，必须严格分离以下三个层次：

### 1. AI 推理层

- 职责：生成高信息密度的思考草稿
- 特性：输出不稳定但内容丰富
- 实现：通过 Reasoner 模型完成深度分析

### 2. 结构协议层（系统内核）

- 职责：定义稳定、可解析的数据契约
- 特性：强约束、可校验、可持久化
- 实现：JSON Schema 与类型定义

### 3. 组织表现层

- 职责：提供交互与可视化能力
- 特性：树形/图形展示、版本对比、协作功能
- 实现：UI 与工具链（后续阶段）

开发重心应长期聚焦于结构协议层，这是系统稳定性的根本保障。

## 三、基础能力建设

### 能力 A：节点可确认性

每个节点必须能够被明确验证，为此需回答四个正交问题：

```typescript
interface ThinkingAtom {
  statement: string;      // What：要做什么
  intent: string;         // Why：业务价值
  constraints: string[];  // Constraints：边界条件
  acceptance: string[];   // Verification：验收标准
}
```

这四维结构将模糊需求转化为可核对的认知资产，是系统有效性的基石。

### 能力 B：局部进化支持

系统必须原生支持细粒度迭代：

- 单节点重拆解
- 子树替换
- 避免全局重建

此能力直接决定系统的实用性与可维护性，是区分玩具与工具的关键。

## 四、工程实现路径

### 两段式处理流水线

已验证有效的核心架构：

1. **Reasoner 阶段**

   - 模型：deepseek-reasoner
   - 输出：自由格式思考稿（含需求理解、拆分逻辑等）
   - 目标：最大化推理质量
2. **Formatter 阶段**

   - 模型：deepseek-chat + JSON mode
   - 输入：原始需求 + 思考稿
   - 输出：严格符合协议的结构化数据
   - 目标：确保输出稳定性

此设计平衡了推理深度与输出可控性，符合人机协作的基本原则。

### 数据分层策略

明确区分两类数据结构：

```typescript
// AI 输出协议（最小约束）
interface DraftNode {
  title: string;
  type: "project" | "module" | "feature";
  atom: ThinkingAtom;
  children: DraftNode[];
}

// 系统内部结构（确认后生成）
interface TreeNode extends DraftNode {
  id: string;           // 系统生成标识
  status: "draft" | "confirmed"; // 确认状态
  // 后续可扩展字段...
}
```

此分层允许协议稳定演进，避免因模型输出变动导致系统重构。

## 五、开发纪律与里程碑

### 核心纪律

1. 抽象必须由实际痛点驱动
2. 每次变更需通过三问检验：
   - 是否增强局部进化能力？
   - 是否降低未来修改成本？
   - 今日是否已产生独立价值？
3. 本地优先：JSON 文件 + Git 版本控制

### 里程碑路线

**M1：协议稳定化**

- 完成两段式流水线
- 验证 ThinkingAtom 四维输出稳定性

**M2：数据持久化**

- 实现运行日志记录（jsonl 格式）
- 支持树结构本地保存

**M3：局部重拆解**

- 实现单节点重生成
- 完成子树替换机制

**M4：确认闭环**

- 引入 draft/confirmed 状态
- 建立人机协作工作流

达成 M3 即标志系统具备可持续进化能力，后续功能均为工程扩展。

## 六、防迷失准则

当面临设计决策时，回归以下原则：

1. TreeOS 的唯一目标是实现思考收敛
2. AI 产出仅为草稿，协议校验才是核心
3. 所有设计必须服务于局部进化能力
4. 无痛点不抽象，无验证不扩展
5. 保持数据载体简单（JSON 文件优先）
6. 无状态调用：每次请求完整注入 system prompt

此宪章旨在提供清晰的技术锚点，确保开发过程始终聚焦于核心价值，避免陷入过度设计或概念迷思。
